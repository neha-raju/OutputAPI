var htmlToJson = require("html-to-json");

var rawData = '{"response":{"status":"ok","userTier":"developer","total":1,"startIndex":1,"pageSize":10,"currentPage":1,"pages":1,"orderBy":"relevance","results":[{"id":"commentisfree/2018/mar/26/the-guardian-view-on-surveillance-make-your-number-unobtainable","type":"article","sectionId":"commentisfree","sectionName":"Opinion","webPublicationDate":"2018-03-26T17:30:44Z","webTitle":"The Guardian view on surveillance: make your number unobtainable | Editorial","webUrl":"https://www.theguardian.com/commentisfree/2018/mar/26/the-guardian-view-on-surveillance-make-your-number-unobtainable","apiUrl":"https://content.guardianapis.com/commentisfree/2018/mar/26/the-guardian-view-on-surveillance-make-your-number-unobtainable","blocks":{"body":[{"id":"2ae76a16-023f-4295-82ce-c0777b6d1ba2","bodyHtml":"<p>One of the strangest features of the current debates about privacy on the internet is the way in which private advertising companies are able to get away with practices that no democratic government could. The security services and police are restricted in their surveillance of private citizens on the web by the <a href=\"http://www.legislation.gov.uk/ukpga/2016/25/contents/enacted\" title=\"\">Investigatory Powers Act 2016</a>. Around 130,000 people signed a petition against it, largely because of the provision requiring internet providers to keep for up to a year records of all the websites that their users visited. One campaigner <a href=\"https://www.theguardian.com/world/2016/nov/29/snoopers-charter-bill-becomes-law-extending-uk-state-surveillance\" title=\"\">described it</a> as “one of the most extreme surveillance laws ever passed in a democracy”.</p> <p>Yet the material collected in this way can only be accessed under a system of legal and political oversight: the Home Office might like more powers, but the European court of justice ruled in December 2016 that independent judicial authorisation was needed for the “general and indiscriminate retention” of personal data. <a href=\"https://www.openrightsgroup.org/legal/mass-surveillance-challenge\" title=\"\">All that fuss</a> over a year’s worth of websites, when it turns out that Facebook has been storing <a href=\"http://www.bbc.co.uk/news/technology-43539881\" title=\"\">all the contact details</a>, the instant messages, and the phone calls of millions of its users for as long as 10 years without anyone outside the firm realising what their apparently innocuous consent implied.</p> <p>It would not be fair to blame Facebook alone for&#xa0;this. The victims of this policy were only the people who used its Messenger app on Android phones, and Android is a Google product. Apple’s rival phones don’t permit such indiscriminate harvesting of information. Although Google made this harder for phones updated since 2012, Android phones are notoriously slow to have their software upgraded, and <a href=\"https://arstechnica.com/information-technology/2018/03/facebook-scraped-call-text-message-data-for-years-from-android-phones/\" title=\"\">the ability was still there</a> even with the most modern phones until October last year. The hapless user believed only that they were allowing Facebook to look through their contacts to make it easier to reach them. In this instance, it is hard to blame Facebook entirely for taking advantage of a feature that Google had deliberately built. Both firms had a vital interest in collecting as much information as possible about their users – and everyone whom their&#xa0;users knew, on or off the network – and helping marketers to use it. What was then advertised or sold with the help of this once private information, whether it was goods or politicians, was of rather less interest. “Once the rockets are up, who cares where they come down?”, <a href=\"https://www.youtube.com/watch?v=QEJ9HrZq7Ro\" title=\"\">as Tom Lehrer sang</a>.</p> <p>However the blame is distributed, the central fact remains that these private companies have been able to embark on a programme of data collection that no government outside China has been able to undertake. They have done so without any judicial oversight of the kind that is meant to bind democratic government. They must now be reined in and brought within the law just as governments are. That&#xa0;is a democratic imperative. In the US, the Federal Trade Commission is <a href=\"https://www.theguardian.com/technology/2018/mar/26/facebook-data-privacy-cambridge-analytica-investigation-ftc-latest\" title=\"\">looking at Facebook’s privacy practices</a>. What will the UK government do?</p>","bodyTextSummary":"One of the strangest features of the current debates about privacy on the internet is the way in which private advertising companies are able to get away with practices that no democratic government could. The security services and police are restricted in their surveillance of private citizens on the web by the Investigatory Powers Act 2016. Around 130,000 people signed a petition against it, largely because of the provision requiring internet providers to keep for up to a year records of all the websites that their users visited. One campaigner described it as “one of the most extreme surveillance laws ever passed in a democracy”. Yet the material collected in this way can only be accessed under a system of legal and political oversight: the Home Office might like more powers, but the European court of justice ruled in December 2016 that independent judicial authorisation was needed for the “general and indiscriminate retention” of personal data. All that fuss over a year’s worth of websites, when it turns out that Facebook has been storing all the contact details, the instant messages, and the phone calls of millions of its users for as long as 10 years without anyone outside the firm realising what their apparently innocuous consent implied. It would not be fair to blame Facebook alone for this. The victims of this policy were only the people who used its Messenger app on Android phones, and Android is a Google product. Apple’s rival phones don’t permit such indiscriminate harvesting of information. Although Google made this harder for phones updated since 2012, Android phones are notoriously slow to have their software upgraded, and the ability was still there even with the most modern phones until October last year. The hapless user believed only that they were allowing Facebook to look through their contacts to make it easier to reach them. In this instance, it is hard to blame Facebook entirely for taking advantage of a feature that Google had deliberately built. Both firms had a vital interest in collecting as much information as possible about their users – and everyone whom their users knew, on or off the network – and helping marketers to use it. What was then advertised or sold with the help of this once private information, whether it was goods or politicians, was of rather less interest. “Once the rockets are up, who cares where they come down?”, as Tom Lehrer sang. However the blame is distributed, the central fact remains that these private companies have been able to embark on a programme of data collection that no government outside China has been able to undertake. They have done so without any judicial oversight of the kind that is meant to bind democratic government. They must now be reined in and brought within the law just as governments are. That is a democratic imperative. In the US, the Federal Trade Commission is looking at Facebook’s privacy practices. What will the UK government do?","attributes":{},"published":true,"createdDate":"2018-03-26T16:32:18Z","lastModifiedDate":"2018-03-26T17:31:16Z","contributors":[],"elements":[{"type":"text","assets":[],"textTypeData":{"html":"<p>One of the strangest features of the current debates about privacy on the internet is the way in which private advertising companies are able to get away with practices that no democratic government could. The security services and police are restricted in their surveillance of private citizens on the web by the <a href=\"http://www.legislation.gov.uk/ukpga/2016/25/contents/enacted\" title=\"\">Investigatory Powers Act 2016</a>. Around 130,000 people signed a petition against it, largely because of the provision requiring internet providers to keep for up to a year records of all the websites that their users visited. One campaigner <a href=\"https://www.theguardian.com/world/2016/nov/29/snoopers-charter-bill-becomes-law-extending-uk-state-surveillance\" title=\"\">described it</a> as “one of the most extreme surveillance laws ever passed in a democracy”.</p> \n<p>Yet the material collected in this way can only be accessed under a system of legal and political oversight: the Home Office might like more powers, but the European court of justice ruled in December 2016 that independent judicial authorisation was needed for the “general and indiscriminate retention” of personal data. <a href=\"https://www.openrightsgroup.org/legal/mass-surveillance-challenge\" title=\"\">All that fuss</a> over a year’s worth of websites, when it turns out that Facebook has been storing <a href=\"http://www.bbc.co.uk/news/technology-43539881\" title=\"\">all the contact details</a>, the instant messages, and the phone calls of millions of its users for as long as 10 years without anyone outside the firm realising what their apparently innocuous consent implied.</p> \n<p>It would not be fair to blame Facebook alone for&#xa0;this. The victims of this policy were only the people who used its Messenger app on Android phones, and Android is a Google product. Apple’s rival phones don’t permit such indiscriminate harvesting of information. Although Google made this harder for phones updated since 2012, Android phones are notoriously slow to have their software upgraded, and <a href=\"https://arstechnica.com/information-technology/2018/03/facebook-scraped-call-text-message-data-for-years-from-android-phones/\" title=\"\">the ability was still there</a> even with the most modern phones until October last year. The hapless user believed only that they were allowing Facebook to look through their contacts to make it easier to reach them. In this instance, it is hard to blame Facebook entirely for taking advantage of a feature that Google had deliberately built. Both firms had a vital interest in collecting as much information as possible about their users – and everyone whom their&#xa0;users knew, on or off the network – and helping marketers to use it. What was then advertised or sold with the help of this once private information, whether it was goods or politicians, was of rather less interest. “Once the rockets are up, who cares where they come down?”, <a href=\"https://www.youtube.com/watch?v=QEJ9HrZq7Ro\" title=\"\">as Tom Lehrer sang</a>.</p> \n<p>However the blame is distributed, the central fact remains that these private companies have been able to embark on a programme of data collection that no government outside China has been able to undertake. They have done so without any judicial oversight of the kind that is meant to bind democratic government. They must now be reined in and brought within the law just as governments are. That&#xa0;is a democratic imperative. In the US, the Federal Trade Commission is <a href=\"https://www.theguardian.com/technology/2018/mar/26/facebook-data-privacy-cambridge-analytica-investigation-ftc-latest\" title=\"\">looking at Facebook’s privacy practices</a>. What will the UK government do?</p>"}}]}],"totalBodyBlocks":1},"isHosted":false,"pillarId":"pillar/opinion","pillarName":"Opinion"}]}}';
var ASX = '{"[{"name": "MOQ LIMITED","code": "MOQ"},{"name": "1-PAGE LIMITED","code": "1PG"},{"name": "1300 SMILES LIMITED","code": "ONT"}]"}';

function showResult(rawData) {
	var newsObj = new Object();
	var obj = new Object();
	var parsed = htmlToJson.parse(rawData);
	obj.newsDataSet = [];

	for (var i = 0; i < parsed.response.results.length; i++) {
		var namesID = lookUpCompany(parsed.response.results[i].blocks.body[0].bodyTextSummary);
		newsObj.CompanyNames = namesID[0]; 
		newsObj.InstrumentIDs = namesID[1];
		newsObj.TimeStamp = parsed.response.results[i].webPublicationDate;
		newsObj.Headline = parsed.response.results[i].webTitle;
		newsObj.NewsText = parsed.response.results[i].blocks.body[0].bodyTextSummary; // assume just 1 body block for now - test this later
		var jsonString = JSON.stringify(newsObj);
		obj.newsDataSet.push(jsonString); 
	}

	var resultJson = JSON.stringify(obj);
	console.log(resultJson);
	return resultJson;
}

function lookUpCompany(text) {
	var names = [];
	var ids = [];

	for (var i = 0; i < ASX.length; i++) {
		if (text.indexOf(ASX[i].name) != -1) {
			names.push(ASX[i].name);
			ids.push(ASX[i].code);
		}
	}
	return [names, ids];
}

// function parsingHtml(s) {
//     var promise = htmlToJson.parse(s, {
//         'text': function ($doc) {
//           return $doc.find('div').text();
//         }
//     }, function (err, result) {
//         console.log(result);
//         return result
//     });



// }



window.onload = showResult(rawData);